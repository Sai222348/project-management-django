{% extends 'adminpanel/staff_base.html' %}

{% block content %}
<div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2 mb-4 pm-action-row">
    <h3 class="mb-0">My Tasks</h3>
    <a href="{% url 'staff_dashboard' %}" class="btn btn-outline-secondary">Back to Dashboard</a>
</div>

<ul class="nav nav-pills flex-wrap gap-2 mb-3">
    <li class="nav-item">
        <a class="nav-link {% if not selected_tab %}active{% endif %}" href="{% url 'staff_my_tasks' %}">
            All <span class="badge text-bg-light ms-1">{{ pending_count|add:in_progress_count|add:completed_count }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if selected_tab == 'pending' %}active{% endif %}" href="{% url 'staff_my_tasks' %}?tab=pending">
            Pending <span class="badge text-bg-light ms-1">{{ pending_count }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if selected_tab == 'in-progress' %}active{% endif %}" href="{% url 'staff_my_tasks' %}?tab=in-progress">
            In Progress <span class="badge text-bg-light ms-1">{{ in_progress_count }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if selected_tab == 'completed' %}active{% endif %}" href="{% url 'staff_my_tasks' %}?tab=completed">
            Completed <span class="badge text-bg-light ms-1">{{ completed_count }}</span>
        </a>
    </li>
</ul>

<div class="card border-0 shadow-sm">
    <div class="card-body">
        <div class="d-md-none">
            {% for task in tasks %}
            <div class="card border mb-3">
                <div class="card-body p-3">
                    <h6 class="mb-2">{{ task.title }}</h6>
                    <p class="mb-1"><strong>Project:</strong> {{ task.project.name|default:task.project_topic|default:"-" }}</p>
                    <p class="mb-1"><strong>Status:</strong> {{ task.status }}</p>
                    <p class="mb-1"><strong>Due Date:</strong> {{ task.due_date }}</p>
                    <p class="mb-3"><strong>Latest Report:</strong> {{ task.latest_update_text|default:"-" }}</p>
                    <div class="d-grid gap-2 pm-stack-mobile">
                        <a href="{% url 'staff_task_detail' task.id %}" class="btn btn-sm btn-outline-dark">View</a>
                        <a href="{% url 'staff_task_update' task.id %}" class="btn btn-sm btn-outline-primary">Update</a>
                        <a href="{% url 'staff_task_history' task.id %}" class="btn btn-sm btn-outline-secondary">History</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <p class="text-center text-muted mb-0">No tasks found for this tab.</p>
            {% endfor %}
        </div>

        <div class="table-responsive pm-table-wrap d-none d-md-block">
            <table class="table table-striped align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Task</th>
                        <th>Project</th>
                        <th>Status</th>
                        <th>Due Date</th>
                        <th>Latest Report</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                    <tr>
                        <td>{{ task.title }}</td>
                        <td>{{ task.project.name|default:task.project_topic|default:"-" }}</td>
                        <td>{{ task.status }}</td>
                        <td>{{ task.due_date }}</td>
                        <td>{{ task.latest_update_text|default:"-" }}</td>
                        <td class="text-nowrap">
                            <a href="{% url 'staff_task_detail' task.id %}" class="btn btn-sm btn-outline-dark">View</a>
                            <a href="{% url 'staff_task_update' task.id %}" class="btn btn-sm btn-outline-primary">Update</a>
                            <a href="{% url 'staff_task_history' task.id %}" class="btn btn-sm btn-outline-secondary">History</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">No tasks found for this tab.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
