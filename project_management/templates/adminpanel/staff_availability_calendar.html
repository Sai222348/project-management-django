{% extends 'adminpanel/staff_base.html' %}

{% block content %}
<div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2 mb-3">
    <h3 class="mb-0">Staff Availability Calendar</h3>
    <div class="d-flex gap-2">
        <a href="{% url 'staff_attendance' %}" class="btn btn-outline-secondary btn-sm">Attendance</a>
        <a href="{% url 'staff_apply_leave' %}" class="btn btn-outline-primary btn-sm">Apply Leave</a>
    </div>
</div>

<div class="card border-0 shadow-sm mb-3">
    <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2">
        <div>
            <h6 class="mb-1">{{ display_month_name }}</h6>
            <div class="small text-muted">Current Availability: {{ availability_status }}{% if leave_until %} (Leave Until {{ leave_until }}){% endif %}</div>
        </div>
        <div class="d-flex gap-2">
            <a class="btn btn-sm btn-outline-dark" href="{% url 'staff_availability_calendar' %}?year={{ prev_year }}&month={{ prev_month }}">Previous</a>
            <a class="btn btn-sm btn-outline-dark" href="{% url 'staff_availability_calendar' %}">Current Month</a>
            <a class="btn btn-sm btn-outline-dark" href="{% url 'staff_availability_calendar' %}?year={{ next_year }}&month={{ next_month }}">Next</a>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-body p-2 p-md-3">
        <div class="table-responsive">
            <table class="table table-bordered align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th class="text-center">Mon</th>
                        <th class="text-center">Tue</th>
                        <th class="text-center">Wed</th>
                        <th class="text-center">Thu</th>
                        <th class="text-center">Fri</th>
                        <th class="text-center">Sat</th>
                        <th class="text-center">Sun</th>
                    </tr>
                </thead>
                <tbody>
                    {% for week in weeks %}
                    <tr>
                        {% for day in week %}
                        <td class="{% if not day.in_month %}bg-light text-muted{% endif %}" style="height:90px; vertical-align:top;">
                            <div class="d-flex justify-content-between">
                                <span class="fw-semibold {% if day.is_today %}text-primary{% endif %}">{{ day.date.day }}</span>
                            </div>
                            {% if day.leave_status == 'Approved' %}
                            <span class="badge text-bg-success mt-2">Leave</span>
                            {% elif day.leave_status == 'Pending' %}
                            <span class="badge text-bg-warning mt-2">Pending Leave</span>
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
